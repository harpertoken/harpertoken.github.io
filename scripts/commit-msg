#!/bin/bash

# Read the commit message from the file passed as argument
commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Extract the first line
first_line=$(echo "$commit_msg" | head -n 1)

# Check if first line is lowercase
if [[ "$first_line" != "$(echo "$first_line" | tr '[:upper:]' '[:lower:]')" ]]; then
    echo "Error: Commit message first line must be lowercase."
    exit 1
fi

# Check length <= 60 chars
if [[ ${#first_line} -gt 60 ]]; then
    echo "Error: Commit message first line must be 60 characters or less."
    exit 1
fi

# Check if it starts with a conventional type
if ! echo "$first_line" | grep -qE '^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert):'; then
    echo "Error: Commit message must start with a conventional type (feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert)."
    exit 1
fi

echo "Commit message is valid."